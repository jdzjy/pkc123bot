<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>123Bot æ§åˆ¶å°</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/styles.css">
    
    <style>
        /* ================= æ—¥å¿—ç»ˆç«¯ä¸“ä¸šç‰ˆæ ·å¼ (VS Code é£æ ¼) ================= */
        :root {
            --log-bg: #15192b;       
            --log-hover: #1e2338;    
            --log-border: #2a2f4a;      
            --text-main: #d0d7de;    
            --text-dim: #6c757d;     
            --col-info: #58a6ff;     
            --col-warn: #d29922;     
            --col-error: #f85149;
        }

        /* æ—¥å¿—å®¹å™¨ */
        .log-container-wrapper {
            background-color: var(--log-bg);
            border: 1px solid var(--log-border);
            border-radius: 6px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            height: 780px; /* å›ºå®šé«˜åº¦ */
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
        }

        /* é¡¶éƒ¨å·¥å…·æ  */
        .log-toolbar {
            background-color: #1a1f32; /* æ¯”æ—¥å¿—èƒŒæ™¯ç¨äº® */
            padding: 10px 16px;
            border-bottom: 1px solid var(--log-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* ä¸‹æ‹‰ç­›é€‰æ¡†èƒŒæ™¯ */
        .log-select {
            background-color: #252a40;
            color: #eee;
            border: 1px solid #3b4261;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            outline: none;
            transition: border 0.2s;
        }
        .log-select:focus { border-color: var(--col-info); }

        /* å¤é€‰æ¡†ç¾åŒ– */
        .log-checkbox-label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #aaa;
            transition: color 0.2s;
        }
        .log-checkbox-label:hover { color: #fff; }
        .log-checkbox-label input { accent-color: var(--col-info); cursor: pointer; }

        /* --- æ—¥å¿—å†…å®¹åŒºåŸŸ --- */
        #log-viewer {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px 0;
            font-size: 13px;
            line-height: 1.5;
            scroll-behavior: smooth;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        #log-viewer::-webkit-scrollbar { width: 10px; }
        #log-viewer::-webkit-scrollbar-track { background: var(--log-bg); }
        #log-viewer::-webkit-scrollbar-thumb { background: #424242; border-radius: 5px; border: 2px solid var(--log-bg); }
        #log-viewer::-webkit-scrollbar-thumb:hover { background: #5a5a5a; }

        /* --- å•æ¡æ—¥å¿—è¡Œå¸ƒå±€ --- */
        .log-entry {
            display: flex;
            padding: 2px 16px;
            border-left: 3px solid transparent; /* çŠ¶æ€æŒ‡ç¤ºæ¡ */
            align-items: flex-start;
        }
        .log-entry:hover { background-color: var(--log-hover); }
        .log-entry.hidden { display: none !important; }

        /* 1. æ—¶é—´åˆ— */
        .log-time {
            color: var(--text-dim);
            min-width: 140px;
            font-size: 12px;
            flex-shrink: 0;
            white-space: nowrap;
            margin-right: 12px;
            padding-top: 1px;
        }

        /* 2. æ¨¡å—æ ‡ç­¾ Badge */
        .log-badge {
            display: inline-block;
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            margin-right: 12px;
            min-width: 65px;
            text-align: center;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            flex-shrink: 0;
            letter-spacing: 0.5px;
        }

        /* 3. å†…å®¹åˆ— */
        .log-msg {
            flex: 1;
            color: var(--text-main);
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* --- é¢œè‰²å®šä¹‰ --- */
        .mod-115 { background-color: #27ae60; }   /* ç»¿è‰² */
        .mod-189 { background-color: #2980b9; }   /* è“è‰² */
        .mod-quark { background-color: #16a085; } /* é’è‰² */
        .mod-main { background-color: #d35400; }  /* æ·±æ©™ */
        .mod-mp { background-color: #8e44ad; }    /* ç´«è‰² */
        .mod-web { background-color: #7f8c8d; }   /* ç°è‰² */
        .mod-other { background-color: #57606f; } /* æ·±ç° */

        /* çº§åˆ«é«˜äº® */
        .level-WARNING { border-left-color: var(--col-warn); background: rgba(230, 162, 60, 0.05); }
        .level-WARNING .log-msg { color: #fae3b8; }
        .level-WARNING .log-time { color: #e6a23c; }

        .level-ERROR { border-left-color: var(--col-error); background: rgba(245, 108, 108, 0.1); }
        .level-ERROR .log-msg { color: #ffbaba; font-weight: bold; }
        .level-ERROR .log-time { color: #f56c6c; }

        /* å †æ ˆè·Ÿè¸ª (Traceback) */
        .log-traceback {
            color: #ff9b9b;
            padding-left: 215px; /* å¯¹é½åˆ°æ¶ˆæ¯å†…å®¹åŒº */
            font-size: 12px;
            opacity: 0.9;
            background: rgba(255, 0, 0, 0.03);
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        
        /* ç³»ç»Ÿæ¶ˆæ¯ */
        .log-system-msg {
            text-align: center;
            padding-top: 150px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="layout-container">
        <aside class="sidebar">
            <div class="logo-container">
                <img src="/static/images/logo.svg" class="sidebar-logo-img" alt="Logo">
                <span class="logo-text">123bot Pro</span>
            </div>
          
            <nav class="nav-menu">
                <div class="nav-label">ç³»ç»Ÿç®¡ç†</div>
                <button type="button" class="nav-item active" data-target="web">
                    <img src="/static/images/web.svg" class="nav-icon-img" alt="Web"> 
                    <span>Webå®‰å…¨é…ç½®</span>
                </button>
                <button type="button" class="nav-item" data-target="tg">
                    <img src="/static/images/userbot.png" class="nav-icon-img" alt="TG"> 
                    <span>TG æœºå™¨äºº/äººå½¢</span>
                </button>
                
                <div class="nav-label" style="margin-top: 15px;">ç½‘ç›˜é…ç½®</div>
                <button type="button" class="nav-item" data-target="123">
                    <img src="/static/images/123.svg" class="nav-icon-img" alt="123"> 
                    <span>123 äº‘ç›˜</span>
                </button>
                <button type="button" class="nav-item" data-target="115">
                    <img src="/static/images/115.png" class="nav-icon-img" alt="115"> 
                    <span>115 ç½‘ç›˜</span>
                </button>
                <button type="button" class="nav-item" data-target="ty">
                    <img src="/static/images/189.svg" class="nav-icon-img" alt="189"> 
                    <span>å¤©ç¿¼äº‘ç›˜</span>
                </button>
                
                <div class="nav-label" style="margin-top: 15px;">ç›‘æ§ä¸ç»´æŠ¤</div>
                <button type="button" class="nav-item" data-target="logs">
                    <img src="/static/images/log.svg" class="nav-icon-img" alt="Log"> 
                    <span>å®æ—¶è¿è¡Œæ—¥å¿—</span>
                </button>
                <button type="button" class="nav-item" data-target="other">
                    <img src="/static/images/gjsz.svg" class="nav-icon-img" alt="Other"> 
                    <span>é«˜çº§/å…¶ä»–é…ç½®</span>
                </button>
            </nav>

            <div class="sidebar-footer">
                <button type="button" class="logout-btn" onclick="logout()">
                    <i class="fas fa-power-off"></i> é€€å‡ºç™»å½•
                </button>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <h2 id="page-title">Webå®‰å…¨é…ç½®</h2>
                <div class="header-actions">
                    <button type="button" class="restart-btn" onclick="restartService()">
                        <i class="fas fa-sync-alt fa-spin-hover"></i> <span>é‡å¯æœåŠ¡</span>
                    </button>
                    <button type="button" class="save-btn" onclick="submitForm()">
                        <i class="fas fa-save"></i> <span>ä¿å­˜æ‰€æœ‰é…ç½®</span>
                    </button>
                </div>
            </header>

            <div class="content-scroll">
                <div id="tg-login-dashboard" style="display:none;">
                    <div class="config-group tg-login-card">
                        <h3><i class="fab fa-telegram-plane"></i> Telegram è´¦æˆ·çŠ¶æ€</h3>
                        
                        <div id="tg-status-loading" style="padding: 40px; text-align: center; color: var(--text-muted);">
                            <i class="fas fa-circle-notch fa-spin fa-2x"></i>
                            <p style="margin-top: 10px;">æ­£åœ¨è¿æ¥æœåŠ¡å™¨æ£€æŸ¥çŠ¶æ€...</p>
                        </div>

                        <div id="tg-logged-in" style="display: none;">
                            <div class="user-info">
                                <div class="avatar"><i class="fas fa-user-astronaut"></i></div>
                                <div>
                                    <div style="color: #94a3b8; font-size: 12px;">å½“å‰ç™»å½•ç”¨æˆ·</div>
                                    <div id="tg-user-name" style="font-weight: bold; font-size: 18px; color: #fff;"></div>
                                    <div id="tg-user-phone" style="color: var(--secondary-color); font-family: monospace;"></div>
                                </div>
                            </div>
                            <button type="button" class="btn-danger" onclick="tgLogout()" style="margin-top: 20px; width: 100%;">
                                <i class="fas fa-sign-out-alt"></i> æ³¨é”€äººå½¢ Session
                            </button>
                        </div>

                        <div id="tg-login-form" style="display: none;">
                            <div id="step-phone">
                                <div class="config-item">
                                    <label><i class="fas fa-mobile-alt"></i> æ‰‹æœºå·ç </label>
                                    <div class="comment">æ ¼å¼æç¤ºï¼šå›½å®¶ä»£ç +æ‰‹æœºå· (ä¾‹å¦‚: +8613800000000)</div>
                                    <input type="text" id="tg-phone-input" placeholder="+86...">
                                </div>
                                <button type="button" class="btn-primary" style="width:100%" onclick="tgSendCode()">
                                    å‘é€éªŒè¯ç  <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>

                            <div id="step-code" style="display: none;">
                                <div class="config-item">
                                    <label><i class="fas fa-shield-alt"></i> ç™»å½•éªŒè¯ç </label>
                                    <div class="comment">è¯·æŸ¥çœ‹æ‚¨çš„ Telegram å®¢æˆ·ç«¯ï¼ˆéçŸ­ä¿¡ï¼‰</div>
                                    <input type="text" id="tg-code-input" placeholder="è¾“å…¥5ä½æ•°å­—éªŒè¯ç " style="letter-spacing: 2px; font-weight: bold;">
                                </div>
                                <div class="btn-row">
                                    <button type="button" class="btn-secondary" onclick="resetTgLogin()">è¿”å›ä¿®æ”¹æ‰‹æœºå·</button>
                                    <button type="button" class="btn-primary" style="flex:1" onclick="tgVerifyCode()">éªŒè¯å¹¶ç™»å½•</button>
                                </div>
                            </div>

                            <div id="step-password" style="display: none;">
                                <div class="config-item">
                                    <label><i class="fas fa-lock"></i> ä¸¤æ­¥éªŒè¯å¯†ç </label>
                                    <div class="comment required">è¯¥è´¦å·å¼€å¯äº†2FAï¼Œè¯·è¾“å…¥äº‘å¯†ç </div>
                                    <input type="password" id="tg-password-input">
                                </div>
                                <div class="btn-row">
                                    <button type="button" class="btn-secondary" onclick="resetTgLogin()">å–æ¶ˆ</button>
                                    <button type="button" class="btn-primary" style="flex:1" onclick="tgVerifyPassword()">æäº¤å¯†ç </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <form id="env-form">
                    <div id="section-web" class="section-pane active"></div>
                    <div id="section-tg" class="section-pane"></div>
                    <div id="section-123" class="section-pane"></div>
                    <div id="section-115" class="section-pane"></div>
                    
                    <div id="section-ty" class="section-pane">
                        <div class="config-group tg-login-card" style="margin-bottom: 20px; padding: 20px; border-color: rgba(255, 115, 0, 0.3); background: linear-gradient(to bottom, var(--bg-card), rgba(255, 115, 0, 0.05));">
                            <h3 style="font-size: 18px; margin-bottom: 15px; padding-bottom: 10px;"><i class="fas fa-key"></i> å¤©ç¿¼äº‘ç›˜ç™»å½•</h3>
                            <div id="ty-tab-manual">
                                <div class="config-item" style="margin-bottom: 15px;">
                                    <label style="margin-bottom: 8px; display: block; color: var(--text-main); font-weight: 500; font-size: 14px;">ENV_189_COOKIES (æ‰‹åŠ¨è·å–)</label>
                                    <div class="comment" style="margin-bottom: 8px;">
                                        PCæµè§ˆå™¨ç™»å½• <a href="https://cloud.189.cn" target="_blank" style="color: #6366f1;">cloud.189.cn</a> -> F12æŠ“åŒ… -> å¤åˆ¶ main.action çš„ Cookie å€¼ã€‚æœ‰æ•ˆæœŸçº¦30å¤©ã€‚
                                    </div>
                                    <input type="text" id="ty-manual-cookie" placeholder="ä¾‹å¦‚ï¼šCOOKIE_LOGIN_USER=...; COOKIES_guid=..." autocomplete="off">
                                </div>
                                <button type="button" class="btn-primary" style="width: 100%;" onclick="saveTyCookie()">
                                    <i class="fas fa-save"></i> ä¿å­˜ Cookie å¹¶é‡å¯
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="section-logs" class="section-pane">
                        <div class="log-container-wrapper">
                            <div class="log-toolbar">
                                <div class="toolbar-group">
                                    <span style="font-weight: bold; color: #fff; font-size: 14px;"><i class="fas fa-terminal"></i> ç»ˆç«¯</span>
                                    
                                    <select id="logFilter" class="log-select" onchange="applyLogFilter()">
                                        <option value="all">ğŸ” æ˜¾ç¤ºå…¨éƒ¨æ¨¡å—</option>
                                        <option value="bot115">ğŸ“‚ 115ç½‘ç›˜</option>
                                        <option value="bot189">â˜ï¸ å¤©ç¿¼äº‘ç›˜</option>
                                        <option value="quark">ğŸª å¤¸å…‹ç½‘ç›˜</option>
                                        <option value="main">ğŸ¤– 123Botæ ¸å¿ƒ</option>
                                        <option value="mp_main">âš™ï¸ å¤šè¿›ç¨‹ä¸»æ§</option>
                                        <option value="werkzeug">ğŸŒ WebæœåŠ¡å™¨</option>
                                    </select>

                                    <label class="log-checkbox-label" title="éšè— GET/POST è¯·æ±‚æ—¥å¿—ï¼Œåªçœ‹ä¸šåŠ¡æ—¥å¿—">
                                        <input type="checkbox" id="hide-werkzeug" onchange="applyLogFilter()" checked>
                                        <span>å±è”½ Web è¯·æ±‚</span>
                                    </label>
                                </div>
                                
                                <div class="toolbar-group">
                                    <label class="log-checkbox-label">
                                        <input type="checkbox" id="auto-scroll-log" checked> 
                                        <span>è‡ªåŠ¨æ»šåŠ¨</span>
                                    </label>
                                    
                                    <button type="button" id="btn-log-switch" class="btn-secondary btn-sm" onclick="toggleLogStream()" style="padding: 4px 12px; border:none; border-radius:3px; cursor:pointer; font-weight:500;">
                                        <i class="fas fa-play"></i> å¼€å§‹å®æ—¶
                                    </button>
                                    
                                    <button type="button" class="btn-outline-secondary btn-sm" onclick="document.getElementById('log-viewer').innerHTML=''" style="padding: 4px 8px; border:1px solid #555; background:transparent; color:#aaa; border-radius:3px; cursor:pointer;" title="æ¸…å±">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div id="log-viewer">
                                <div class="log-system-msg">
                                    <i class="fas fa-satellite-dish fa-3x" style="margin-bottom: 20px; opacity: 0.5;"></i><br>
                                    ç­‰å¾…è¿æ¥...<br>
                                    <span style="font-size: 12px; opacity: 0.7;">ç‚¹å‡»å³ä¸Šè§’â€œå¼€å§‹å®æ—¶â€æ¥å…¥æ—¥å¿—æµ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="section-other" class="section-pane"></div>
                </form>
            </div>
        </main>
    </div>

    <div id="notification" class="notification"></div>
    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
        <p style="color: white; font-weight: 500; letter-spacing: 1px;">SYSTEM PROCESSING</p>
    </div>

    <script src="/static/script.js"></script>
    <script>
        function submitForm() {
            document.getElementById('env-form').dispatchEvent(new Event('submit'));
        }
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç®¡ç†åå°å—ï¼Ÿ')) {
                fetch('/api/logout', { method: 'POST' }).then(() => window.location.href = '/login');
            }
        }
    </script>
</body>
</html>
